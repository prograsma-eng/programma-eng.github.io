<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prograsma123 | Admin Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <div class="header-container">
            <div class="logo-container">
                <div class="logo-box">DEVS</div>
                <h1 class="logo-text">Desarrolladores de<span> Roblox</span></h1>
            </div>
            
            <div class="header-search">
                <input type="text" id="buscador-input" placeholder="Buscar scripts, sistemas o autores...">
            </div>

            <div id="user-button"></div>
        </div>
    </header>

    <main class="main-content">
        
        <section class="hero-section">
            <div class="hero-text">
                <h2 class="hero-title">Comunidad de Desarrolladores <span>Roblox</span></h2>
                <p class="hero-subtitle">Explora, comparte y gestiona tus sistemas de forma profesional en una sola plataforma creado por Prograsma123.</p>
            </div>
            
            <div class="hero-stats">
                <div class="stat-item">
                    <span class="stat-value">Compartir</span>
                    <span class="stat-label">Sistemas</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">Free</span>
                    <span class="stat-label">Acceso</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">24/7</span>
                    <span class="stat-label">Comunidad</span>
                </div>
            </div>
        </section>

        <section id="panel-admin" class="admin-panel" style="display: none;">
            <div class="admin-header">
                <span class="admin-badge">üõ°Ô∏è Panel de Seguridad</span>
                <h2 class="admin-title">Reportes de la Comunidad</h2>
            </div>
            <div id="contenedor-reportes">Cargando reportes...</div>
        </section>

        <section id="seccion-publicar" class="publish-section">
            <div class="section-header">
                <div class="icon-box">üöÄ</div>
                <div class="text-box">
                    <h3 class="publish-title">Compartir Nuevo Sistema</h3>
                    <p class="publish-desc">Organiza tus scripts en una carpeta p√∫blica.</p>
                </div>
            </div>

            <form id="form-sistema">
                <div class="form-row">
                    <input type="text" id="sys-titulo" placeholder="Nombre del sistema (ej: Anti-Exploit)" required>
                    <select id="sys-tag">
                        <option value="General">üìÇ Categor√≠a: General</option>
                        <option value="GUI">üé® Categor√≠a: GUI / UI</option>
                        <option value="Combate">‚öîÔ∏è Categor√≠a: Combate</option>
                        <option value="Admin">üõ†Ô∏è Categor√≠a: Admin Tools</option>
                    </select>
                </div>

                <div id="archivos-input-container" class="scripts-input-list">
                    </div>

                <div class="form-actions">
                    <button type="button" class="btn-add-script" onclick="agregarCampoArchivo()">+ A√±adir Script a la Carpeta</button>
                    <button type="submit" class="btn-submit">Publicar en la Comunidad</button>
                </div>
            </form>
        </section>

        <nav class="filter-bar">
            <button class="filter-btn active">Todos los sistemas</button>
            <button class="filter-btn">M√°s Valorados üî•</button>
            <button class="filter-btn">Recientes</button>
            <button class="filter-btn">Mis Publicaciones</button>
        </nav>

        <div id="contenedor-sistemas" class="systems-grid">
            </div>

    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <p>&copy; 2026 Prograsma123 - Hecho para desarrolladores de Roblox.</p>
            <div class="footer-links">
                <a href="#">T√©rminos</a>
                <a href="#">Privacidad</a>
                <a href="#">Soporte</a>
            </div>
        </div>
    </footer>

    <script type="module">
        // Mantenemos toda tu l√≥gica de Firebase y Clerk exactamente igual
        window.editandoId = null;
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, updateDoc, increment, setDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyA6HiPcffZ6fCvaXm0RKjs2Zd-t_siSjb4", authDomain: "robloxcommunity-bb652.firebaseapp.com", projectId: "robloxcommunity-bb652", storageBucket: "robloxcommunity-bb652.firebasestorage.app", messagingSenderId: "114286923700", appId: "1:114286923700:web:d6cb6a07d36bf85e6b6ce1" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const MI_ADMIN_ID = "user_38PKS4GkQcDO4xszlKRmaRUpc1W";
        let todosLosSistemas = [];

        function resaltarRoblox(codigo) {
            if (!codigo) return "";
            let esc = codigo.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            return esc
                .replace(/("(.*?)"|'(.*?)')/g, '<span style="color:var(--lua-string)">$1</span>')
                .replace(/\b(function|local|if|then|else|elseif|end|while|for|do|return|and|or|not|true|false|nil)\b/g, '<span style="color:var(--lua-keyword)">$1</span>')
                .replace(/\b(game|workspace|script|Instance|Vector3|CFrame|Color3|task|wait|spawn|print|warn|error|getgenv|getsenv)\b/g, '<span style="color:var(--lua-builtin)">$1</span>')
                .replace(/(--.*)/g, '<span style="color:var(--lua-comment)">$1</span>')
                .replace(/\b(\d+)\b/g, '<span style="color:var(--lua-number)">$1</span>');
        }

        // L√≥gica de Clerk
        const scriptClerk = document.createElement('script');
        scriptClerk.setAttribute('data-clerk-publishable-key', 'pk_test_Z3VpZGVkLWNvbGxpZS0yOC5jbGVyay5hY2NvdW50cy5kZXYk');
        scriptClerk.async = true;
        scriptClerk.src = 'https://allowed-moth-84.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js';
        scriptClerk.onload = async () => {
            await Clerk.load();
            if (Clerk.user) {
                window.currentUser = Clerk.user;
                Clerk.mountUserButton(document.getElementById('user-button'));
                document.getElementById('seccion-publicar').style.display = 'block';
                if (Clerk.user.id === MI_ADMIN_ID) cargarPanelAdmin();
                agregarCampoArchivo();
            } else {
                document.getElementById('user-button').innerHTML = `<button onclick="Clerk.openSignIn()" style="background:var(--accent); border:none; padding:10px 22px; border-radius:12px; cursor:pointer; font-weight:bold; color:black;">Iniciar Sesi√≥n</button>`;
            }
        };
        document.head.appendChild(scriptClerk);

        // Renderizado mejorado
        onSnapshot(query(collection(db, "sistemas"), orderBy("likes", "desc")), (snap) => {
            todosLosSistemas = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderizar();
        });

      function renderizar() {
    const cont = document.getElementById('contenedor-sistemas');
    cont.innerHTML = todosLosSistemas.map(sys => {
        const esDueno = window.currentUser && sys.creadorId === window.currentUser.id;
        const modoEdicionActivo = window.editandoId === sys.id;

        return `
        <div class="sistema-container" style="${modoEdicionActivo ? 'border: 1px solid var(--accent); box-shadow: 0 0 15px rgba(0,212,255,0.1);' : ''}">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <img src="${sys.foto}" style="width:48px; height:48px; border-radius:15px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                    <div>
                        <div style="display:flex; align-items:center; gap:8px;">
                            <h2 id="title-${sys.id}" 
                                contenteditable="${modoEdicionActivo}" 
                                onblur="guardarTitulo('${sys.id}')"
                                style="margin:0; font-size:1.15rem; font-weight:700; ${modoEdicionActivo ? 'border-bottom:2px solid var(--accent); background:rgba(0,212,255,0.05); padding:0 5px;' : ''}">${sys.titulo}</h2>
                            <span class="tag-badge">#${sys.tag}</span>
                        </div>
                        <p style="margin:0; font-size:0.8rem; color:var(--text-dim);">Creado por <span style="color:white; font-weight:600;">${sys.autor}</span></p>
                    </div>
                </div>
                <div style="display:flex; gap:10px; align-items:center;">
                    ${esDueno ? `
                        <button onclick="toggleModoEditor('${sys.id}')" style="background:none; border:none; cursor:pointer; font-size:1.2rem; transition:0.3s;" title="Editar Sistema">
                            ${modoEdicionActivo ? '‚úÖ' : '‚úèÔ∏è'}
                        </button>
                    ` : ''}
                    <button onclick="reportarSistema('${sys.id}', '${sys.titulo}')" style="background:none; border:none; cursor:pointer; opacity:0.5;">üö©</button>
                    ${esDueno ? `<button onclick="eliminarSistema('${sys.id}')" style="background:none; border:none; cursor:pointer; opacity:0.5;">üóëÔ∏è</button>` : ''}
                    <button class="btn-like" onclick="darLike('${sys.id}')">‚ù§Ô∏è <span>${sys.likes || 0}</span></button>
                </div>
            </div>

            ${sys.archivos.map((arc, i) => {
                // L√≥gica de colores mejorada
                let colorTipo = "#475569"; // Gris por defecto
                if (arc.tipo === "MODULE") colorTipo = "#a855f7"; // Morado
                if (arc.tipo === "SCRIPT") colorTipo = "#22c55e"; // Verde
                if (arc.tipo === "LOCAL") colorTipo = "#3b82f6";  // Azul
                
                return `
                <div class="archivo-header" onclick="toggleArchivo('${sys.id}-${i}')">
                    <span style="display:flex; align-items:center; gap:10px;">
                        <span class="tipo-badge" style="background:${colorTipo} !important; color:white; padding:2px 8px; border-radius:6px; font-size:0.7rem; font-weight:bold; min-width:60px; text-align:center;">
                            ${arc.tipo}
                        </span> 
                        <b style="font-family:'Fira Code'; font-size:0.9rem;">${arc.nombre}.lua</b>
                    </span>
                    <div style="display:flex; gap:5px;">
                        <button class="btn-copy" onclick="event.stopPropagation(); copiarCodigo('${sys.id}-${i}')">üìã Copiar</button>
                        ${modoEdicionActivo ? `
                            <button class="btn-save" onclick="event.stopPropagation(); guardarEdicion('${sys.id}', ${i})">üíæ</button>
                            <button class="btn-delete-script" onclick="event.stopPropagation(); eliminarScript('${sys.id}', ${i})" style="background:#ef4444; border:none; color:white; border-radius:6px; cursor:pointer; padding:5px 8px;">‚úï</button>
                        ` : ''}
                    </div>
                </div>
                
                <div class="codigo-wrapper" id="wrap-${sys.id}-${i}">
                    <div class="editor-container" style="display:none; ${modoEdicionActivo ? 'border: 1px solid var(--accent);' : ''}">
                        <div class="line-numbers">${arc.codigo.split('\n').map((_,idx)=>idx+1).join('<br>')}</div>
                        <pre><code id="edit-${sys.id}-${i}" 
                             contenteditable="${modoEdicionActivo}" 
                             spellcheck="false"
                             style="${modoEdicionActivo ? 'outline:none;' : ''}">${resaltarRoblox(arc.codigo)}</code></pre>
                    </div>
                </div>`;
            }).join('')}

            ${modoEdicionActivo ? `
                <div style="padding: 10px 25px;">
                    <button onclick="nuevoScriptEnSistema('${sys.id}')" 
                            style="width:100%; padding:10px; border: 2px dashed var(--accent); background:transparent; color:var(--accent); border-radius:12px; cursor:pointer; font-weight:600; transition:0.3s;">
                        + Agregar otro Script a esta carpeta
                    </button>
                </div>
            ` : ''}

            <div style="margin-top:25px; background: rgba(0,0,0,0.1); border-radius: 15px; padding: 15px;">
                <form onsubmit="enviarComentario(event, '${sys.id}')" style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" placeholder="Escribe tu opini√≥n..." style="margin:0; flex-grow:1; border-radius:10px; padding:10px; border:none; background:rgba(255,255,255,0.05);">
                    <button type="submit" style="background:var(--accent); color:black; border:none; padding:0 15px; border-radius:10px; cursor:pointer; font-weight:bold;">Enviar</button>
                </form>
                <div id="coms-${sys.id}" style="display:flex; flex-direction:column; gap:8px;"></div>
            </div>
        </div>`;
    }).join('');

    // Re-ejecutar listeners de comentarios
    todosLosSistemas.forEach(sys => {
        onSnapshot(query(collection(db, "sistemas", sys.id, "comentarios"), orderBy("fecha", "asc")), (snap) => {
            const cDiv = document.getElementById(`coms-${sys.id}`);
            if (cDiv) cDiv.innerHTML = snap.docs.map(d => `
                <div class="comentario-item">
                    <div style="display:flex; gap:10px; align-items:center;">
                        <img src="${d.data().foto}" class="comentario-avatar" style="width:24px; height:24px;">
                        <b style="color:var(--accent); font-size:0.75rem;">${d.data().autor}</b>
                    </div>
                    <p style="margin:5px 0 0 34px; font-size:0.85rem; color:var(--text-dim);">${d.data().texto}</p>
                </div>
            `).join('');
        });
    });
}

// A√±adir despu√©s de renderizar()
document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        // Quitar clase active de todos y poner al actual
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const filtro = btn.innerText;
        const cont = document.getElementById('contenedor-sistemas');
        const cards = cont.querySelectorAll('.sistema-container');

        cards.forEach((card, index) => {
            const sys = todosLosSistemas[index];
            if (!sys) return;

            if (filtro.includes("Todos")) card.style.display = "block";
            else if (filtro.includes("Mis Publicaciones")) {
                card.style.display = (window.currentUser && sys.creadorId === window.currentUser.id) ? "block" : "none";
            }
            else if (filtro.includes("M√°s Valorados")) {
                // L√≥gica simple: ocultar si tiene 0 likes
                card.style.display = (sys.likes > 0) ? "block" : "none";
            }
        });
    });
});

        // --- FUNCIONES GLOBALES (Mismas que antes) ---
 window.toggleArchivo = (id) => {
    const wrapper = document.getElementById(`wrap-${id}`);
    const editor = wrapper.querySelector('.editor-container');
    if (editor) {
        editor.style.display = (editor.style.display === 'flex') ? 'none' : 'flex';
    }
};

// ACTIVAR/DESACTIVAR EL L√ÅPIZ (EDICI√ìN)
window.toggleModoEditor = (id) => {
    if (window.editandoId === id) {
        window.editandoId = null; 
        alert("Modo edici√≥n desactivado.");
    } else {
        window.editandoId = id; 
    }
    renderizar(); // Esto refresca la lista y activa los botones extra
};
// --- NUEVAS FUNCIONES DE EDICI√ìN Y UTILIDAD ---

// Copiar c√≥digo al portapapeles
window.nuevoScriptEnSistema = async (sysId) => {
    // 1. Pedir el nombre
    const nombre = prompt("Nombre del nuevo script (ej: Config):");
    if (!nombre) return;
    
    // 2. Pedir el tipo con opciones claras
    const tipoIngresado = prompt("Elige el tipo (Escribe el n√∫mero):\n1. MODULE (ModuleScript)\n2. SCRIPT (Server Script)\n3. LOCAL (LocalScript)", "2");
    
    let tipoFinal = "Script"; // Por defecto
    if (tipoIngresado === "1") tipoFinal = "Modulo";
    if (tipoIngresado === "3") tipoFinal = "LocalScript";

    const sistema = todosLosSistemas.find(s => s.id === sysId);
    if (!sistema) return;

    // Crear el nuevo objeto
    const nuevoArchivo = {
        nombre: nombre,
        tipo: tipoFinal,
        codigo: `-- Nuevo ${tipoFinal} creado\nlocal function init()\n\nend\n\nreturn init`
    };

    // Actualizar en Firebase
    const nuevosArchivos = [...sistema.archivos, nuevoArchivo];

    try {
        await updateDoc(doc(db, "sistemas", sysId), { 
            archivos: nuevosArchivos 
        });
        alert(`üöÄ ${tipoFinal} "${nombre}" a√±adido con √©xito.`);
    } catch (e) {
        console.error(e);
        alert("Error al a√±adir script.");
    }
};
window.copiarCodigo = (id) => {
    // Obtenemos el texto plano ignorando el HTML del resaltado
    const codigo = document.getElementById(`edit-${id}`).innerText;
    navigator.clipboard.writeText(codigo).then(() => {
        alert("üöÄ C√≥digo copiado al portapapeles con √©xito.");
    }).catch(err => {
        console.error('Error al copiar: ', err);
    });
};

// Guardar nuevo nombre de la carpeta (T√≠tulo)
window.guardarTitulo = async (id) => {
    const el = document.getElementById(`title-${id}`);
    if (!el) return;
    const nuevoTitulo = el.innerText;
    try {
        await updateDoc(doc(db, "sistemas", id), { titulo: nuevoTitulo });
    } catch (e) {
        console.error("Error al actualizar t√≠tulo", e);
    }
};
// Eliminar un script espec√≠fico de la carpeta
window.guardarEdicion = async (sysId, arcIndex) => {
    const nuevoCodigo = document.getElementById(`edit-${sysId}-${arcIndex}`).innerText;
    const sistema = todosLosSistemas.find(s => s.id === sysId);
    if (!sistema) return;

    const nuevosArchivos = [...sistema.archivos];
    nuevosArchivos[arcIndex].codigo = nuevoCodigo;

    try {
        await updateDoc(doc(db, "sistemas", sysId), { archivos: nuevosArchivos });
        alert("‚úÖ Cambios guardados en la nube.");
    } catch (error) {
        alert("‚ùå Error al guardar.");
    }
};

window.eliminarScript = async (sysId, index) => {
    if(!confirm("¬øEliminar este script de la carpeta?")) return;
    const sistema = todosLosSistemas.find(s => s.id === sysId);
    if (!sistema) return;

    const nuevosArchivos = [...sistema.archivos];
    nuevosArchivos.splice(index, 1);

    try {
        await updateDoc(doc(db, "sistemas", sysId), { archivos: nuevosArchivos });
    } catch (e) {
        alert("Error al eliminar.");
    }
};

        window.descargarLua = (n, c) => {
            const blob = new Blob([c], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `${n}.lua`; a.click();
            URL.revokeObjectURL(url);
        };

        window.enviarComentario = async (e, id) => {
            e.preventDefault();
            const inp = e.target.querySelector('input');
            if(!inp.value.trim() || !window.currentUser) return;
            await addDoc(collection(db, "sistemas", id, "comentarios"), {
                texto: inp.value, autor: window.currentUser.fullName, foto: window.currentUser.imageUrl, fecha: serverTimestamp()
            });
            inp.value = '';
        };

       window.darLike = async (id) => {
    if (!window.currentUser) return Clerk.openSignIn(); // Primero loguear
    const sys = todosLosSistemas.find(s => s.id === id);

    // [Personalizaci√≥n aplicada: El creador no puede darse likes a s√≠ mismo]
    if (sys.creadorId === window.currentUser.id) {
        return alert("¬°No puedes darte like a ti mismo!");
    }

    const vRef = doc(db, "sistemas", id, "votosUnicos", window.currentUser.id);
    const votoDoc = await getDoc(vRef);

    try {
        if (votoDoc.exists()) {
            // SI YA EXISTE: Quitamos el like (Toggle OFF)
            await deleteDoc(vRef);
            await updateDoc(doc(db, "sistemas", id), { 
                likes: increment(-1) 
            });
            console.log("Like quitado");
        } else {
            // SI NO EXISTE: Damos el like (Toggle ON)
            await setDoc(vRef, { v: 1 });
            await updateDoc(doc(db, "sistemas", id), { 
                likes: increment(1) 
            });
            console.log("Like dado");
        }
    } catch (error) {
        console.error("Error en el sistema de likes:", error);
    }
};

// Funci√≥n para que el Admin ignore (borre) un reporte
window.ignorarReporte = async (reporteId) => {
    try {
        await deleteDoc(doc(db, 'reportes', reporteId));
        // No hace falta alert, onSnapshot actualizar√° la lista solo
    } catch (error) {
        console.error("Error al eliminar reporte:", error);
        alert("No se pudo eliminar el reporte.");
    }
};


        window.reportarSistema = async (id, t) => {
            const m = prompt(`¬øPor qu√© deseas reportar "${t}"?`);
            if(!m) return;
            await addDoc(collection(db, "reportes"), { sistemaId: id, titulo: t, motivo: m, por: window.currentUser.fullName, fecha: serverTimestamp() });
            alert("üö© Gracias por el aviso. Lo revisaremos.");
        };

        window.eliminarSistema = async (id) => { if(confirm("¬øEst√°s seguro de borrar este sistema para siempre?")) await deleteDoc(doc(db, "sistemas", id)); };

        window.agregarCampoArchivo = () => {
            const div = document.createElement('div');
            div.className = "archivo-input-item";
            div.style = "background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; margin-bottom: 15px; position: relative; border: 1px solid rgba(255,255,255,0.05);";
            div.innerHTML = `
                <select class="tipo-selector" style="margin-bottom:15px; border-color:rgba(255,255,255,0.1);"><option value="MODULE">ModuleScript</option><option value="SCRIPT">Script</option><option value="LOCAL">LocalScript</option></select>
                <input type="text" class="archivo-nombre" placeholder="Nombre del archivo (ej: Loader)" required>
                <textarea class="archivo-codigo" rows="6" placeholder="Pega aqu√≠ tu c√≥digo de Roblox..." required style="font-family:'Fira Code'; font-size:0.8rem;"></textarea>
                <button type="button" onclick="this.parentElement.remove()" style="position:absolute; top:10px; right:10px; background:#ef4444; border:none; color:white; width:25px; height:25px; border-radius:50%; cursor:pointer; font-weight:bold;">√ó</button>
            `;
            document.getElementById('archivos-input-container').appendChild(div);
        };

        function cargarPanelAdmin() {
            document.getElementById('panel-admin').style.display = 'block';
            onSnapshot(collection(db, "reportes"), (snap) => {
                document.getElementById('contenedor-reportes').innerHTML = snap.docs.map(d => `
                    <div style="background:rgba(239, 68, 68, 0.1); padding:15px; margin-bottom:12px; border-radius:12px; border:1px solid rgba(239, 68, 68, 0.2); display:flex; justify-content:space-between; align-items:center;">
                        <div><b style="color:#ef4444;">${d.data().titulo}</b><p style="margin:5px 0; font-size:0.85rem;">${d.data().motivo}</p></div>
                        <div style="display:flex; gap:10px;">
                            <button onclick="eliminarSistema('${d.data().sistemaId}')" style="background:#ef4444; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:bold;">Borrar Sistema</button>
                          <button onclick="ignorarReporte('${d.id}')" style="background:#475569; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer;">Ignorar</button>
                        </div>
                    </div>
                `).join('');
            });
        }

        // L√≥gica del formulario de env√≠o
        document.getElementById('form-sistema').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.innerText = "Publicando..."; btn.disabled = true;

            const archivosItems = document.querySelectorAll('.archivo-input-item');
            const archivos = Array.from(archivosItems).map(item => ({
                tipo: item.querySelector('.tipo-selector').value,
                nombre: item.querySelector('.archivo-nombre').value,
                codigo: item.querySelector('.archivo-codigo').value
            }));

            try {
                await addDoc(collection(db, "sistemas"), {
                    titulo: document.getElementById('sys-titulo').value,
                    tag: document.getElementById('sys-tag').value,
                    archivos: archivos,
                    autor: window.currentUser.fullName,
                    creadorId: window.currentUser.id,
                    foto: window.currentUser.imageUrl,
                    likes: 0,
                    fecha: serverTimestamp()
                });
                alert("¬°Sistema publicado con √©xito! üöÄ");
                location.reload();
            } catch (err) {
                alert("Error al publicar: " + err.message);
                btn.innerText = "Publicar"; btn.disabled = false;
            }
        });

        // Buscador din√°mico
        document.getElementById('buscador-input').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.sistema-container');
            cards.forEach(card => {
                const text = card.innerText.toLowerCase();
                card.style.display = text.includes(term) ? 'block' : 'none';
            });
        });
        // Funci√≥n para actualizar n√∫meros de l√≠nea en tiempo real
document.addEventListener('input', (e) => {
    if (e.target.getAttribute('contenteditable') === 'true' && e.target.id.startsWith('edit-')) {
        const idFull = e.target.id.replace('edit-', ''); // Obtenemos el ID del sistema y el √≠ndice
        const lineNumbersDiv = e.target.closest('.editor-container').querySelector('.line-numbers');
        
        // Contamos las l√≠neas actuales bas√°ndonos en el texto
        const lineCount = e.target.innerText.split('\n').length;
        
        // Generamos los n√∫meros nuevos
        let numbersHTML = "";
        for (let i = 1; i <= lineCount; i++) {
            numbersHTML += i + "<br>";
        }
        
        lineNumbersDiv.innerHTML = numbersHTML;
    }
});
    </script>
</body>
</html>
